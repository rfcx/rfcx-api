name: 'EKS-CD-SEC'
on:
  workflow_dispatch:
  push:
    branches:
      - eks-branch
#      - staging
concurrency: ${{ github.workflow }}-${{ github.ref }}
jobs:

  configure:
    name: 'Configure'
    runs-on: ubuntu-latest
    outputs:
      namespace: ${{ steps.configuration.outputs.namespace }}
      environment: ${{ steps.configuration.outputs.environment }}
    steps:
      - name: 'Conditional environment'
        id: configuration
        run: |
          echo "::set-output name=namespace::eks-test-ns"
          echo "::set-output name=environment::staging/core-api"

  test_secrets:
    name: 'Test_secrets'
    environment: staging/core-api
    env: 
      input_json: ${{ toJson(secrets) }}
    steps:
      - name: 'echo secrets'
        run: |
          echo $input_json
#  deploy:
#    name: 'Deploy'
#    needs: [configure]
#    uses: rfcx/cicd/.github/workflows/eks-reusable-k8s-deploy-sec.yaml@eks_cicd
#    with:
#      tag: ${{ needs.build.outputs.unique-tag }}
#      namespace: ${{ needs.configure.outputs.namespace }}
#      environment: ${{ needs.configure.outputs.environment }}
#    secrets: inherit
