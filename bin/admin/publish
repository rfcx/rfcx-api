#!/usr/bin/env bash

export SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )";
cd $SCRIPT_DIR/../../;

read -p "Are you sure you want to deploy this version to AWS? (y/n): " -n 1 -r

if [[ $REPLY =~ ^[Yy]$ ]]
then

  echo -e "\nYou chose 'yes'.\n";
  if grep -q "\"^" "package.json"; then
     echo -e "\nYou may not deploy with a ^ in your package.json. Please use exact versions instead."
     exit 1
  fi
  read -p "Would you like to deploy to the (s)taging or (p)roduction environment? (s/p): " -n 1 -r

  if [[ $REPLY =~ ^[Pp]$ ]]
  then
    echo -e "\nYou chose to deploy to 'production'.\n"
    # git checkout deploy;
    # git merge master -m "Merging with master branch.";
    echo -e "\nExecuting deployment script (this may take a few minutes).\n"
    eb deploy rfcx-api-production-env;
  else
    echo -e "\nYou chose to deploy to 'staging'.\n"
    # git checkout deploy;
    # git merge master -m "Merging with master branch.";
    echo -e "\nExecuting deployment script (this may take a few minutes).\n"
    eb deploy rfcx-api-staging-new;
  fi

  # git checkout master;

  if [[ $REPLY =~ ^[Pp]$ ]]
  then
    eb status rfcx-api-production-env;
  else
    eb status rfcx-api-staging-new;
  fi

else
  echo -e "\nYou chose NOT to deploy the application to AWS.\n";
  # git checkout master;
fi
